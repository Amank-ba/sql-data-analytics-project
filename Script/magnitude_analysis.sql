/*
===============================================================================
MAGNITUDE ANALYSIS
===============================================================================
PURPOSE:
    - TO QUANTIFY DATA AND GROUP RESULTS BY SPECIFIC DIMENSIONS.
    - FOR UNDERSTANDING DATA DISTRIBUTION ACROSS CATEGORIES.

SQL FUNCTIONS USED:
    - AGGREGATE FUNCTIONS: SUM(), COUNT(), AVG()
    - GROUP BY, ORDER BY
===============================================================================
*/

-- FIND TOTAL CUSTOMERS BY COUNTRIES
SELECT
    COUNTRY,
    COUNT(CUSTOMER_KEY) AS TOTAL_CUSTOMERS
FROM GOLD_DIM_CUSTOMERS
GROUP BY COUNTRY
ORDER BY TOTAL_CUSTOMERS DESC;

-- FIND TOTAL CUSTOMERS BY GENDER
SELECT
    GENDER,
    COUNT(CUSTOMER_KEY) AS TOTAL_CUSTOMERS
FROM GOLD_DIM_CUSTOMERS
GROUP BY GENDER
ORDER BY TOTAL_CUSTOMERS DESC;

-- FIND TOTAL PRODUCTS BY CATEGORY
SELECT
    CATEGORY,
    COUNT(PRODUCT_KEY) AS TOTAL_PRODUCTS
FROM GOLD_DIM_PRODUCTS
GROUP BY CATEGORY
ORDER BY TOTAL_PRODUCTS DESC;

-- FIND THE AVERAGE COSTS IN EACH CATEGORY
SELECT
    CATEGORY,
    AVG(COST) AS AVG_COST
FROM GOLD_DIM_PRODUCTS
GROUP BY CATEGORY
ORDER BY AVG_COST DESC;

-- FIND THE TOTAL REVENUE GENERATED FOR EACH CATEGORY
SELECT
    P.CATEGORY,
    SUM(F.SALES_AMOUNT) AS TOTAL_REVENUE
FROM GOLD_FACT_SALES F
LEFT JOIN GOLD_DIM_PRODUCTS P
    ON P.PRODUCT_KEY = F.PRODUCT_KEY
GROUP BY P.CATEGORY
ORDER BY TOTAL_REVENUE DESC;

-- FIND THE TOTAL REVENUE GENERATED BY EACH CUSTOMER
SELECT
    C.CUSTOMER_KEY,
    C.FIRST_NAME,
    C.LAST_NAME,
    SUM(F.SALES_AMOUNT) AS TOTAL_REVENUE
FROM GOLD_FACT_SALES F
LEFT JOIN GOLD_DIM_CUSTOMERS C
    ON C.CUSTOMER_KEY = F.CUSTOMER_KEY
GROUP BY 
    C.CUSTOMER_KEY,
    C.FIRST_NAME,
    C.LAST_NAME
ORDER BY TOTAL_REVENUE DESC;

-- FIND THE DISTRIBUTION OF SOLD ITEMS ACROSS COUNTRIES
SELECT
    C.COUNTRY,
    SUM(F.QUANTITY) AS TOTAL_SOLD_ITEMS
FROM GOLD_FACT_SALES F
LEFT JOIN GOLD_DIM_CUSTOMERS C
    ON C.CUSTOMER_KEY = F.CUSTOMER_KEY
GROUP BY C.COUNTRY
ORDER BY TOTAL_SOLD_ITEMS DESC;
